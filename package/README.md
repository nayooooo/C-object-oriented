# C语言面向对象之封装 #

面向对象的思想可以大大简化编程过程中的困难，因此学会C语言面向对象思想显得尤其重要，如果能够写出优美的程序框架甚至类似于Lua语言的面向对象升级模块，那可谓十分厉害了。

## 类的属性 ##

类的封装，不得不提到属性和行为，而属性看上去则较为简单，因此我们先来讨论封装属性。

C语言提供了结构体这一数据结构，我们可以很方便地使用结构体来实现对属性地封装。

## 类的行为 ##

再谈到类的行为，我们可以通过函数指针的形式对其进行封装，另外，为了将其和属性区分开来，我另外创建了一个结构体，在这个结构体中包含着所有的类行为，称为 `行为表` 。值得改进的一点是，在这个示例中，我想到的方法是每创建一个对象就创建若干个函数指针，这样是对资源的极大浪费，后续可以对其进行改进。

## 私有化成员属性 ##

私有化不得不让我们想到将结构体仅声明在源文件中，这样该源文件外的其它文件就无法对私有化的属性和行为进行直接访问了。由此引出了另外一个问题，我们怎么将一个类中的事物清晰地分成两部分而使用时不太复杂呢？此时又能通过C语言的数据结构 `联合体类型` 来解决了，联合体类型一次只能访问其中的一个成员，因此可以用来隐藏私有部分，具体的做法如下：

    typedef struct Class_Internal{
        union{
            Class public;
            void *intro;
        };
        uint8_t age;
        Class_Internal_Method_Table *ivptr;
    }Class_Internal;

其中包含了一个联合体类型的变量，它有两个成员，分别是 `public` 和 `intro`，其中public是类的公有部分，intro是占位符，它不起实际作用，当我们访问私有部分时，为了“专注于”私有部分，应该忽略联合体中的public成员，而当访问公有部分时，也应当忽略联合体中的intro成员。

## 注意点 ##

### new_Class ###

示例中的 `new_Class()` “构造函数”为方便起见设计成了返回对象指针的方式，简化了返回对象后需要数据拷贝的过程。

### delete_Class ###

示例的 `delete_Class()` “析构函数”由于本人能力有限，无法实现通过 `delete_Class(this)` 的方式进行析构，只能将其设计成 `obj = delete_Class(obj)` 的形式。
